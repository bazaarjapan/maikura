# 要件定義書

## 機能概要
Vite + TypeScript + Three.js で実装する“プレイ可能なブロックワールド”の基盤機能（移動、地形、ブロック操作、保存、描画最適化）を提供する。`.sdd/description.md` のMVPを本specの対象とする。

## ユーザーストーリー
- プレイヤーとして、WASDとマウスで自然な一人称操作をしたい。なぜなら探索と建築を快適に行いたいから。
- プレイヤーとして、ブロックを直感的に置いたり壊したりしたい。なぜなら地形を編集して遊びたいから。
- プレイヤーとして、再読み込みしても編集内容が残っていてほしい。なぜなら継続的に世界を作りたいから。

## 機能要件
### 要件1：チャンク化されたワールド生成
- 16×16×H（H=128目安）のチャンク単位で高さ関数により地形を生成。視界外チャンクは破棄/再生成。
- 受入基準：
  - [ ] プレイヤー周囲のチャンクが遅延生成されること
  - [ ] 視界距離の変更に応じて生成/破棄が動的に行われること

### 要件2：描画最適化（メッシング）
- InstancedMesh または Greedy Meshingを用いて面数を削減。ピクセル比は上限（例：2）。
- 受入基準：
  - [ ] フルHD・描画距離既定で60fps（最低30fps）を維持
  - [ ] 面数が想定上限（例：150k面）に収まること

### 要件3：ブロック設置/破壊と範囲制限
- レイキャストで対象ブロックを特定し、左クリック破壊/右クリック設置（射程8m）。ロールオーバー表示。
- 受入基準：
  - [ ] 100回連続操作で破壊/設置の位置が正確（誤差±0.01以内）
  - [ ] 範囲外では操作が無効になること

### 要件4：永続化（差分保存）
- 変更差分をIndexedDBへ保存/復元（`world:{seed}:{cx}:{cz}`キー）。
- 受入基準：
  - [ ] 再読み込み後に直前の編集が再現されること
  - [ ] 保存サイズがチャンク数に概ね比例すること

### 要件5：操作/HUD/開始UI
- クリックでPointer Lock、中央クロスヘア、ヘルプ（H）/FPS表示を追加。
- 受入基準：
  - [ ] Lock/Unlockで想定どおりUIが切り替わること
  - [ ] FPS・座標が正しく更新されること

## 非機能要件
- パフォーマンス：フルHD・DPR≤2・描画距離既定で60fps目標（最低30fps）。
- セキュリティ：HTTPS環境でPointer Lock動作、秘密情報は`import.meta.env`経由でのみ参照。
- 可搬性：Three.jsはCDN版のバージョン固定と自己ホストfallback方針を文書化。

